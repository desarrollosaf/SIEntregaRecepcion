<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div *ngIf="isLoading" class="d-flex justify-content-center align-items-center vh-100">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Cargando...</span>
  </div>
</div>
<div class="row">
  <div class="col-md-12 stretch-card">
    <div class="card">
      <div class="card-body">

        @if(!mostrarForm){
        <div class="container py-4">
          <div class="row w-100 mx-0 auth-page">
            <div class="mx-auto col-12 col-md-11 col-lg-12" style="max-width: 1200px;">
              <div class="card shadow-sm">
                <div class="card-header bg-primary text-white text-center">
                  <h5 class="mb-0">Ingresa tus datos</h5>
                </div>
                <div class="alert alert-dark" role="alert" style="text-align: justify;">
                  Para realizar tu donativo, ingresa en la caja de texto <b>la cantidad que deseas aportar</b>,
                  asegurándote de que el monto sea <b>numérico y mayor o igual a $1.00 pesos.</b>
                  <br>
                  <br>
                  Evita el uso de comas ni símbolos adicionales. El importe que registres será <b>descontado
                    automáticamente de tu percepción quincenal de la segunda quincena de octubre del presente año. </b>
                  <br>
                  <br>
                  <b>Envía el formulario</b> para continuar con el proceso. Enseguida recibirás <b> un correo
                    electrónico con un token de validación</b>, el cual deberás abrir desde la cuenta registrada y <b>
                    dar clic en el enlace incluido</b> para confirmar la aportación registrada. Esta validación es
                  indispensable para autorizar el descuento del monto correspondiente en tu <b>percepción quincenal.
                  </b>


                  <br>
                  <br>
                  Al enviar el formulario, otorgas <b>tu consentimiento expreso y voluntario</b> para que el monto
                  indicado sea retenido y destinado íntegramente al <b>fondo de apoyo a los damnificados por las lluvias
                    en los estados de Hidalgo, Puebla y Veracruz. </b>

                  <br>
                  <br>
                  Una vez confirmada la validación, el <b>sistema emitirá automáticamente tu comprobante digital de
                    donativo</b>, que servirá como acuse y autorización del descuento.
                </div>
                <div class="card-body">
                  <form [formGroup]="registroForm" (ngSubmit)="enviardatos()">
                    <div class="row mb-3">
                      <div class="col-12 col-sm-6">
                        <label class="form-label fw-bold">Nombre completo:</label>
                        <div class="form-control-plaintext border rounded p-2 bg-light text-dark">
                          {{ nombreCompleto }}
                        </div>
                      </div>
                      <div class="col-12 col-sm-6">
                        <label for="cantidad" class="form-label fw-semibold">Cantidad*:</label>
                        <div class="input-group">
                          <span class="input-group-text">
                            <i class="bi bi-cash-stack"></i>
                          </span>
                          <input id="cantidad" type="number" class="form-control" formControlName="cantidad"
                            placeholder="Ej. 15000"
                            [ngClass]="{ 'is-invalid': registroForm.get('cantidad')?.touched && registroForm.get('cantidad')?.invalid }" />
                        </div>
                        <div class="invalid-feedback d-block"
                          *ngIf="registroForm.get('cantidad')?.touched && registroForm.get('cantidad')?.invalid">
                          <div *ngIf="registroForm.get('cantidad')?.errors?.['required']">
                            La cantidad es obligatoria.
                          </div>
                          <div *ngIf="registroForm.get('cantidad')?.errors?.['pattern']">
                            Solo se permiten números enteros.
                          </div>
                          <div *ngIf="registroForm.get('cantidad')?.errors?.['max']">
                            La cantidad no puede ser mayor a 500,000.
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-12 col-sm-6">
                        <label for="correo" class="form-label fw-semibold">Correo*:</label>
                        <div class="input-group">
                          <span class="input-group-text">
                            <i class="bi bi-envelope"></i>
                          </span>
                          <input id="correo" type="email" class="form-control" formControlName="correo"
                            placeholder="ejemplo@correo.com" [ngClass]="{
                      'is-invalid':
                        (registroForm.get('correo')?.touched && registroForm.get('correo')?.invalid) ||
                        registroForm.errors?.correoNoCoincide
                    }" />
                        </div>
                        <div class="invalid-feedback d-block"
                          *ngIf="registroForm.get('correo')?.touched && registroForm.get('correo')?.invalid">
                          <div *ngIf="registroForm.get('correo')?.errors?.['required']">El correo es obligatorio.</div>
                          <div *ngIf="registroForm.get('correo')?.errors?.['email']">El correo no es válido.</div>
                        </div>
                      </div>
                      <div class="col-12 col-sm-6">
                        <label for="confirmarCorreo" class="form-label fw-semibold">Confirmar correo*:</label>
                        <div class="input-group">
                          <span class="input-group-text">
                            <i class="bi bi-envelope-check"></i>
                          </span>
                          <input id="confirmarCorreo" type="email" class="form-control"
                            formControlName="confirmarCorreo" placeholder="Confirma tu correo" [ngClass]="{
                      'is-invalid':
                        (registroForm.get('confirmarCorreo')?.touched && registroForm.get('confirmarCorreo')?.invalid) ||
                        registroForm.errors?.correoNoCoincide
                    }" />
                        </div>
                        <div class="invalid-feedback d-block"
                          *ngIf="registroForm.errors?.correoNoCoincide && registroForm.get('confirmarCorreo')?.touched">
                          Los correos no coinciden.
                        </div>
                      </div>
                    </div>
                    <div class="row mb-3">
                      <div class="col-12 col-sm-6">
                        <label for="telefono" class="form-label fw-semibold">Teléfono*:</label>
                        <div class="input-group">
                          <span class="input-group-text">
                            <i class="bi bi-telephone"></i>
                          </span>
                          <input id="telefono" type="text" class="form-control" formControlName="telefono"
                            placeholder="Solo números" [ngClass]="{
                      'is-invalid':
                        (registroForm.get('telefono')?.touched && registroForm.get('telefono')?.invalid) ||
                        registroForm.errors?.telefonoNoCoincide
                    }" />
                        </div>
                        <div class="invalid-feedback d-block"
                          *ngIf="registroForm.get('telefono')?.touched && registroForm.get('telefono')?.invalid">
                          <div *ngIf="registroForm.get('telefono')?.errors?.['required']">El teléfono es obligatorio.
                          </div>
                          <div *ngIf="registroForm.get('telefono')?.errors?.['pattern']">Solo se permiten números.</div>
                        </div>
                      </div>
                      <div class="col-12 col-sm-6">
                        <label for="confirmarTelefono" class="form-label fw-semibold">Confirmar teléfono*:</label>
                        <div class="input-group">
                          <span class="input-group-text">
                            <i class="bi bi-telephone-plus"></i>
                          </span>
                          <input id="confirmarTelefono" type="text" class="form-control"
                            formControlName="confirmarTelefono" placeholder="Confirma tu teléfono" [ngClass]="{
                      'is-invalid':
                        (registroForm.get('confirmarTelefono')?.touched && registroForm.get('confirmarTelefono')?.invalid) ||
                        registroForm.errors?.telefonoNoCoincide
                    }" />
                        </div>
                        <div class="invalid-feedback d-block"
                          *ngIf="registroForm.errors?.telefonoNoCoincide && registroForm.get('confirmarTelefono')?.touched">
                          Los teléfonos no coinciden.
                        </div>
                      </div>
                    </div>
                    <div class="form-check mt-4">
                      <input type="checkbox" class="form-check-input" id="avisoPrivacidadCheck"
                        [checked]="aceptaPrivacidad" (click)="!aceptaPrivacidad && abrirModal()"
                        [disabled]="aceptaPrivacidad" />
                      <label class="form-check-label" for="avisoPrivacidadCheck">
                        Leer consentimiento
                      </label>
                    </div>
                    <div class="d-flex justify-content-center mt-4">
                      <button type="submit" class="submit-anim-btn"
                        [disabled]="registroForm.invalid || isSubmitting || !aceptaPrivacidad"
                        [ngClass]="{ animating: isSubmitting }">
                        <span *ngIf="!isSubmitting">Enviar</span>

                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                          <path d="M0 11c2.761.575 6.312 1.688 9 3.438 
             3.157-4.23 8.828-8.187 15-11.438
             -5.861 5.775-10.711 12.328-14 18.917
             -2.651-3.766-5.547-7.271-10-10.917z" />
                        </svg>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
        }@else{
        <div class="container">
          <div class="row w-100 mx-0 auth-page">
            <div class="mx-auto">
              <h3 class="text-center mb-4">Mi donación</h3>
              <div class="table-responsive">
                <table class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th class="text-center">PDF</th>
                      <th class="text-center">Folio</th>
                      <th class="text-center">Nombre</th>
                      <th class="text-center">Correo</th>
                      <th class="text-center">Teléfono</th>
                      <th class="text-center">Cantidad</th>

                    </tr>
                  </thead>
                  <tbody>
                    <tr class="table-active">
                      <td class="text-center">
                        <ng-container *ngIf="datosDona.estatus == 1; else noDisponible">
                         <a [href]="'/backend/' + datosDona.path" target="_blank" title="Ver PDF">
                            <i class="bi bi-file-earmark-pdf-fill text-danger fs-4"></i>
                          </a>
                        </ng-container>
                        <ng-template #noDisponible>
                          <span class="text-muted">No disponible</span>
                        </ng-template>
                      </td>
                      <td class="text-center">{{ datosDona.folio }}</td>
                      <td class="text-center">{{ nombreCompleto }}</td>
                      <td class="text-center">{{ datosDona.correo }}</td>
                      <td class="text-center">{{ datosDona.telefono }}</td>
                      <td class="text-center">$ {{ datosDona.cantidad }}</td>

                    </tr>
                  </tbody>
                </table>
              </div>

            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
</div>

<ng-template #xlModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" style="color: #96134b;">CONSENTIMIENTO</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('cerrado')"></button>
  </div>
  <div class="modal-body">
    <p style="text-align: justify;">Por medio del presente documento, manifiesto de manera libre y voluntaria mi
      consentimiento para el apoyo solidario a los damificados por las lluvias organizado por Congreso del Estado de
      México.
      <br>
      <br>
      Declaro que este apoyo se realiza sin fines de lucro ni coerción alguna, y con la convicción de contribuir al
      bienestar de quienes más lo necesitan.
      <br>
      <br>
      Asimismo, autorizo que mi donativo sea administrado y entregado conforme a los mecanismos que determine la
      institución, garantizando su uso con fines humanitarios y de manera transparente.
    </p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="aceptarPrivacidad()">Aceptar</button>
  </div>
</ng-template>